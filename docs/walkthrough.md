# Walkthrough: SNS 자동화 기능 구현

X(Twitter)와 Instagram에 이미지를 자동으로 게시할 수 있는 통합 API 인프라 구축을 완료했습니다.

## 1. 구현된 핵심 기능

### 통합 SNS 게시 API
*   **경로:** `src/app/api/sns/post/route.ts`
*   **기능:** 하나의 API 호출로 X와 Instagram에 동시 또는 선택적 게시 가능.
*   **보안:** Firebase Admin 권한이 있는 사용자만 호출 가능.

### 하이브리드 AI 콘텐츠 생성 (Hybrid LLM Pipeline)
*   **Gemini 2.5 Flash (Drafting):** 전략서(`docs/`) + 트렌드 데이터 + 에디토리얼 방향을 분석하여 기획 Brief 생성.
*   **Claude Sonnet 4.5 (Polishing):** Brief를 K-POP ≥50% 하한선 규칙, 브랜드 톤, 금지어 규칙을 적용하여 최종 SNS 본문으로 다듬기.
*   **Fallback:** `ANTHROPIC_API_KEY` 미설정 시 Gemini 결과 그대로 사용 (기존 동작 유지).
*   **이점:** 월간 운영 비용을 대폭 절감하면서도 최상급 콘텐츠 품질 유지.

### 플랫폼별 처리 로직
*   **X (Twitter):** `twitter-api-v2`를 사용하여 이미지 업로드 및 트윗 게시 (최대 4장).
*   **Instagram:** Instagram Graph API를 통해 2단계(이미지 컨테이너 생성 -> 게시) 프로세스 자동화.

## 2. 설정 가이드

`.env.local` 파일에 다음 정보를 입력해야 작동합니다:

### X (Twitter)
- `X_API_KEY`, `X_API_SECRET_KEY`
- `X_ACCESS_TOKEN`, `X_ACCESS_TOKEN_SECRET`

### Instagram
- `INSTAGRAM_BUSINESS_ACCOUNT_ID`
- `INSTAGRAM_ACCESS_TOKEN`

## 3. 검증 및 테스트 방법

자동화 기능을 테스트하기 위해 전용 스크립트를 준비했습니다.

1.  **개발 서버 실행:** `npm run dev`
2.  **테스트 스크립트 실행:**
    ```bash
    # <ID_TOKEN> 자리에 실제 Firebase 로그인 토큰을 넣으세요.
    node scripts/verify-sns-automation.mjs <ID_TOKEN> x,instagram
    ```

### 🛡️ 4. 안전 및 기술 고도화 (Safety & Strategic Refinement)
최근 업데이트를 통해 법적 리스크와 운영 안정성을 위한 기술적 장치가 추가되었습니다.

- **자동 봇 고지 (Bot Disclosure):** 모든 게시물 하단에 `(Generated by KALEI AI)` 문구가 자동으로 삽입됩니다.
- **X(Twitter) 속도 제한 (Rate Limiting):** 스팸 방지를 위해 유저당 시간당 최대 5회 게시로 제한합니다.
- **Instagram URL 검증:** 게시 전 이미지 URL의 외부 접근성(Publicly Accessible)을 실시간 검증하여 게시 실패를 사전에 방지합니다.

### 에디토리얼 자동 진화 (Editorial Evolution)
*   트렌드와 성과 데이터를 기반으로 에디토리얼 방향을 4단계 시간 스케일(일간/주간/월간/분기)로 자동 조정.
*   Gemini 2.5 Flash로 내부 분석 후 Firestore `bot_settings` 컬렉션에 지시문 저장.
*   모든 초안 생성 시 `getEditorialDirectionPrompt()`로 지시문 자동 주입.
*   스케줄: 01:00(일간), 02:00(주간/일요일), 03:00(월간/1일), 04:00(분기) KST.

## 🚀 향후 계획 (Future Plans)

- [ ] **UI 연동:** 스튜디오 또는 'Style Pick' 페이지에 관리자용 "SNS 일괄 공유" 버튼 추가.
- [ ] **틱톡 연동:** 틱톡 서비스 심사(Audit) 완료 후 추가 구현 예정.
- [ ] **Remotion 기반 비디오 자동화:** React 코드로 릴스 영상을 자동 생성하는 엔진 구축.

---
> [!TIP]
> **성공적인 자동 게시를 위해:** 
> 인스타그램의 경우 등록하는 이미지 URL이 반드시 **공개적(Public)**이어야 합니다. 파이어베이스 스토리지의 공개 다운로드 URL을 사용하면 문제없이 게시됩니다.
